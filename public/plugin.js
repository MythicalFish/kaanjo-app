(function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};this.WebSocketRails=function(){function n(n,e){this.url=n,this.use_websockets=null==e||e,this.connection_stale=t(this.connection_stale,this),this.pong=t(this.pong,this),this.supports_websockets=t(this.supports_websockets,this),this.dispatch_channel=t(this.dispatch_channel,this),this.unsubscribe=t(this.unsubscribe,this),this.subscribe_private=t(this.subscribe_private,this),this.subscribe=t(this.subscribe,this),this.dispatch=t(this.dispatch,this),this.trigger_event=t(this.trigger_event,this),this.trigger=t(this.trigger,this),this.unbind=t(this.unbind,this),this.bind=t(this.bind,this),this.connection_established=t(this.connection_established,this),this.new_message=t(this.new_message,this),this.reconnect=t(this.reconnect,this),this.callbacks={},this.channels={},this.queue={},this.connect()}return n.prototype.connect=function(){return this.state="connecting",this._conn=this.supports_websockets()&&this.use_websockets?new n.WebSocketConnection(this.url,this):new n.HttpConnection(this.url,this),this._conn.new_message=this.new_message},n.prototype.disconnect=function(){return this._conn&&(this._conn.close(),delete this._conn._conn,delete this._conn),this.state="disconnected"},n.prototype.reconnect=function(){var t,n,e,i,s;e=null!=(i=this._conn)?i.connection_id:void 0,this.disconnect(),this.connect(),s=this.queue;for(n in s)t=s[n],t.connection_id!==e||t.is_result()||this.trigger_event(t);return this.reconnect_channels()},n.prototype.new_message=function(t){var e,i,s,c,o,r;for(r=[],s=0,c=t.length;c>s;s++)i=t[s],e=new n.Event(i),e.is_result()?(null!=(o=this.queue[e.id])&&o.run_callbacks(e.success,e.data),delete this.queue[e.id]):e.is_channel()?this.dispatch_channel(e):e.is_ping()?this.pong():this.dispatch(e),r.push("connecting"===this.state&&"client_connected"===e.name?this.connection_established(e.data):void 0);return r},n.prototype.connection_established=function(t){return this.state="connected",this._conn.setConnectionId(t.connection_id),this._conn.flush_queue(),null!=this.on_open?this.on_open(t):void 0},n.prototype.bind=function(t,n){var e;return null==(e=this.callbacks)[t]&&(e[t]=[]),this.callbacks[t].push(n)},n.prototype.unbind=function(t){return delete this.callbacks[t]},n.prototype.trigger=function(t,e,i,s){var c,o;return c=new n.Event([t,e,null!=(o=this._conn)?o.connection_id:void 0],i,s),this.trigger_event(c)},n.prototype.trigger_event=function(t){var n,e;return null==(n=this.queue)[e=t.id]&&(n[e]=t),this._conn&&this._conn.trigger(t),t},n.prototype.dispatch=function(t){var n,e,i,s,c;if(null!=this.callbacks[t.name]){for(s=this.callbacks[t.name],c=[],e=0,i=s.length;i>e;e++)n=s[e],c.push(n(t.data));return c}},n.prototype.subscribe=function(t,e,i){var s;return null==this.channels[t]?(s=new n.Channel(t,this,(!1),e,i),this.channels[t]=s,s):this.channels[t]},n.prototype.subscribe_private=function(t,e,i){var s;return null==this.channels[t]?(s=new n.Channel(t,this,(!0),e,i),this.channels[t]=s,s):this.channels[t]},n.prototype.unsubscribe=function(t){return null!=this.channels[t]?(this.channels[t].destroy(),delete this.channels[t]):void 0},n.prototype.dispatch_channel=function(t){return null!=this.channels[t.channel]?this.channels[t.channel].dispatch(t.name,t.data):void 0},n.prototype.supports_websockets=function(){return"function"==typeof WebSocket||"object"==typeof WebSocket},n.prototype.pong=function(){var t,e;return t=new n.Event(["websocket_rails.pong",{},null!=(e=this._conn)?e.connection_id:void 0]),this._conn.trigger(t)},n.prototype.connection_stale=function(){return"connected"!==this.state},n.prototype.reconnect_channels=function(){var t,n,e,i,s;i=this.channels,s=[];for(e in i)n=i[e],t=n._callbacks,n.destroy(),delete this.channels[e],n=n.is_private?this.subscribe_private(e):this.subscribe(e),n._callbacks=t,s.push(n);return s},n}()}).call(this),function(){WebSocketRails.Event=function(){function t(t,n,e){var i;this.success_callback=n,this.failure_callback=e,this.name=t[0],i=t[1],null!=i&&(this.id=null!=i.id?i.id:65536*(1+Math.random())|0,this.channel=null!=i.channel?i.channel:void 0,this.data=null!=i.data?i.data:i,this.token=null!=i.token?i.token:void 0,this.connection_id=t[2],null!=i.success&&(this.result=!0,this.success=i.success))}return t.prototype.is_channel=function(){return null!=this.channel},t.prototype.is_result=function(){return"undefined"!=typeof this.result},t.prototype.is_ping=function(){return"websocket_rails.ping"===this.name},t.prototype.serialize=function(){return JSON.stringify([this.name,this.attributes()])},t.prototype.attributes=function(){return{id:this.id,channel:this.channel,data:this.data,token:this.token}},t.prototype.run_callbacks=function(t,n){return this.success=t,this.result=n,this.success===!0?"function"==typeof this.success_callback?this.success_callback(this.result):void 0:"function"==typeof this.failure_callback?this.failure_callback(this.result):void 0},t}()}.call(this),function(){WebSocketRails.AbstractConnection=function(){function t(t,n){this.dispatcher=n,this.message_queue=[]}return t.prototype.close=function(){},t.prototype.trigger=function(t){return"connected"!==this.dispatcher.state?this.message_queue.push(t):this.send_event(t)},t.prototype.send_event=function(t){return null!=this.connection_id?t.connection_id=this.connection_id:void 0},t.prototype.on_close=function(t){var n;return this.dispatcher&&this.dispatcher._conn===this?(n=new WebSocketRails.Event(["connection_closed",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(n)):void 0},t.prototype.on_error=function(t){var n;return this.dispatcher&&this.dispatcher._conn===this?(n=new WebSocketRails.Event(["connection_error",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(n)):void 0},t.prototype.on_message=function(t){return this.dispatcher&&this.dispatcher._conn===this?this.dispatcher.new_message(t):void 0},t.prototype.setConnectionId=function(t){this.connection_id=t},t.prototype.flush_queue=function(){var t,n,e,i;for(i=this.message_queue,n=0,e=i.length;e>n;n++)t=i[n],this.trigger(t);return this.message_queue=[]},t}()}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var s in e)t.call(e,s)&&(n[s]=e[s]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};WebSocketRails.WebSocketConnection=function(t){function e(t,n){this.url=t,this.dispatcher=n,e.__super__.constructor.apply(this,arguments),this.url.match(/^wss?:\/\//)?console.log("WARNING: Using connection urls with protocol specified is depricated"):this.url="https:"===window.location.protocol?"wss://"+this.url:"ws://"+this.url,this._conn=new WebSocket(this.url),this._conn.onmessage=function(t){return function(n){var e;return e=JSON.parse(n.data),t.on_message(e)}}(this),this._conn.onclose=function(t){return function(n){return t.on_close(n)}}(this),this._conn.onerror=function(t){return function(n){return t.on_error(n)}}(this)}return n(e,t),e.prototype.connection_type="websocket",e.prototype.close=function(){return this._conn.close()},e.prototype.send_event=function(t){return e.__super__.send_event.apply(this,arguments),this._conn.send(t.serialize())},e}(WebSocketRails.AbstractConnection)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};WebSocketRails.Channel=function(){function n(n,e,i,s,c){var o,r,h;this.name=n,this._dispatcher=e,this.is_private=null!=i&&i,this.on_success=s,this.on_failure=c,this._failure_launcher=t(this._failure_launcher,this),this._success_launcher=t(this._success_launcher,this),this._callbacks={},this._token=void 0,this._queue=[],r=this.is_private?"websocket_rails.subscribe_private":"websocket_rails.subscribe",this.connection_id=null!=(h=this._dispatcher._conn)?h.connection_id:void 0,o=new WebSocketRails.Event([r,{data:{channel:this.name}},this.connection_id],this._success_launcher,this._failure_launcher),this._dispatcher.trigger_event(o)}return n.prototype.destroy=function(){var t,n,e;return this.connection_id===(null!=(e=this._dispatcher._conn)?e.connection_id:void 0)&&(n="websocket_rails.unsubscribe",t=new WebSocketRails.Event([n,{data:{channel:this.name}},this.connection_id]),this._dispatcher.trigger_event(t)),this._callbacks={}},n.prototype.bind=function(t,n){var e;return null==(e=this._callbacks)[t]&&(e[t]=[]),this._callbacks[t].push(n)},n.prototype.unbind=function(t){return delete this._callbacks[t]},n.prototype.trigger=function(t,n){var e;return e=new WebSocketRails.Event([t,{channel:this.name,data:n,token:this._token},this.connection_id]),this._token?this._dispatcher.trigger_event(e):this._queue.push(e)},n.prototype.dispatch=function(t,n){var e,i,s,c,o,r;if("websocket_rails.channel_token"===t)return this.connection_id=null!=(c=this._dispatcher._conn)?c.connection_id:void 0,this._token=n.token,this.flush_queue();if(null!=this._callbacks[t]){for(o=this._callbacks[t],r=[],i=0,s=o.length;s>i;i++)e=o[i],r.push(e(n));return r}},n.prototype._success_launcher=function(t){return null!=this.on_success?this.on_success(t):void 0},n.prototype._failure_launcher=function(t){return null!=this.on_failure?this.on_failure(t):void 0},n.prototype.flush_queue=function(){var t,n,e,i;for(i=this._queue,n=0,e=i.length;e>n;n++)t=i[n],this._dispatcher.trigger_event(t);return this._queue=[]},n}()}.call(this);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var o=!1;if("function"==typeof define&&define.amd&&(define(e),o=!0),"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=e(),o=!0),!o){var t=window.Cookies,n=window.Cookies=e();n.noConflict=function(){return window.Cookies=t,n}}}(function(){function e(){for(var e=0,o={};e<arguments.length;e++){var t=arguments[e];for(var n in t)o[n]=t[n]}return o}function o(t){function n(o,r,i){var c;if("undefined"!=typeof document){if(arguments.length>1){if(i=e({path:"/"},n.defaults,i),"number"==typeof i.expires){var f=new Date;f.setMilliseconds(f.getMilliseconds()+864e5*i.expires),i.expires=f}i.expires=i.expires?i.expires.toUTCString():"";try{c=JSON.stringify(r),/^[\{\[]/.test(c)&&(r=c)}catch(p){}r=t.write?t.write(r,o):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),o=encodeURIComponent(String(o)),o=o.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),o=o.replace(/[\(\)]/g,escape);var s="";for(var u in i)i[u]&&(s+="; "+u,i[u]!==!0&&(s+="="+i[u]));return document.cookie=o+"="+r+s}o||(c={});for(var a=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,l=0;l<a.length;l++){var y=a[l].split("="),m=y.slice(1).join("=");this.json||'"'!==m.charAt(0)||(m=m.slice(1,-1));try{var v=y[0].replace(d,decodeURIComponent);if(m=t.read?t.read(m,v):t(m,v)||m.replace(d,decodeURIComponent),this.json)try{m=JSON.parse(m)}catch(p){}if(o===v){c=m;break}o||(c[v]=m)}catch(p){}}return c}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(o,t){n(o,"",e(t,{expires:-1}))},n.withConverter=o,n}return o(function(){})});
"use strict";function detectBrowser(e){function r(r){return r.concat(r[1].exec(e))}function i(e){return!!e[2]}var o=[["edge",/Edge\/([0-9\._]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+)\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/iPad.*Version\/([0-9\._]+)/],["ios",/iPhone.*Version\/([0-9\._]+)/],["safari",/Version\/([0-9\._]+).*Safari/]],n=0,s=[];for(n=0;n<o.length;n++)o[n]=r(o[n]),i(o[n])&&s.push(o[n]);for(var t=s[0],a=t&&t[3].split(/[._]/).slice(0,3);a&&a.length<3;)a.push("0");return{name:t&&t[0],version:a&&a.join(".")}}
"use strict";var Kaanjo={};Kaanjo.socket=new WebSocketRails("dashboard.kaanjo.co/websocket"),Kaanjo.init=function(){if(Kaanjo.container=document.getElementById("kaanjo"),!Kaanjo.valid(Kaanjo.container))return!1;for(var a in Kaanjo.attributes)Kaanjo.attributes[a]=Kaanjo.container.getAttribute("data-"+a);Kaanjo.request("init",{campaign_id:Kaanjo.cid,webmaster_sid:Kaanjo.attributes.key,product_name:Kaanjo.attributes.name,product_sid:Kaanjo.attributes.id,customer_sid:Kaanjo.cookies.get("kaanjo_cid"),url:window.location.href,device:detectBrowser(navigator.userAgent).name},function(a){Kaanjo.log("Kaanjo initialized"),a.msg&&Kaanjo.log(a.msg),a.c_sid&&Kaanjo.cookies.set("kaanjo_cid",a.c_sid),Kaanjo.render_buttons()},function(a){Kaanjo.log(a.msg)})},Kaanjo.react=function(a){Kaanjo.request("react",{id:a},function(n){Kaanjo.log(n.msg),Kaanjo.select(a)},function(a){Kaanjo.log(a.msg)})},Kaanjo.select=function(a){var n=document.getElementsByClassName("kaanjo-reaction"),o=[];o.forEach.call(n,function(a){a.classList.add("kaanjo-unselected")});var t=document.getElementById("kaanjo-reaction"+a);t.classList.remove("kaanjo-unselected"),Kaanjo.render_status()},Kaanjo.render_buttons=function(){Kaanjo.request("get_buttons",{},function(a){Kaanjo.container.innerHTML=a})},Kaanjo.render_status=function(){Kaanjo.request("get_status",{},function(a){document.getElementById("kaanjo-status").innerHTML=a})},Kaanjo.cookies=Cookies.noConflict(),Kaanjo.request=function(a,n,o,t){Kaanjo.socket.trigger(a,n,o,t)},Kaanjo.valid=function(a){var n=!0;if(null==a)n=!1;else for(var o in Kaanjo.attributes)a.hasAttribute("data-"+o)||"id"===o||(console.error("Kaanjo: You are missing the '"+o+"' attribute in your HTML."),n=!1);return n},Kaanjo.attributes={key:null,name:null,id:null},Kaanjo.log=function(a){a&&console.log(a)},Kaanjo.socket.on_open=function(a){setTimeout(function(){Kaanjo.init()},500)};