{"version":3,"sources":["websocket_rails.0.0.1.min.js","js.cookie.js","detect-browser.js","plugin.js"],"names":["factory","registeredInModuleLoader","define","amd","exports","module","OldCookies","window","Cookies","api","noConflict","extend","i","result","arguments","length","attributes","key","init","converter","value","document","path","defaults","expires","Date","setMilliseconds","getMilliseconds","toUTCString","JSON","stringify","test","e","write","encodeURIComponent","String","replace","decodeURIComponent","escape","stringifiedAttributes","attributeName","cookie","cookies","split","rdecode","parts","slice","join","json","charAt","name","read","parse","set","get","call","getJSON","apply","remove","withConverter","detectBrowser","userAgentString","browsers","mapped","createMatch","isMatch","push","match","pair","concat","exec","version","Kaanjo","socket","WebSocketRails","container","getElementById","valid","attribute","getAttribute","request","campaign_id","cid","webmaster_sid","product_name","product_sid","id","customer_sid","url","location","href","device","navigator","userAgent","log","success","msg","c_sid","render_buttons","fail","react","reaction_id","select","buttons","getElementsByClassName","arr","forEach","button","classList","add","render_status","innerHTML","html","action","data","trigger","hook","is_valid","hasAttribute","console","error","on_open","setTimeout"],"mappings":"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","file":"plugin.js","sourcesContent":["(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};this.WebSocketRails=function(){function WebSocketRails(url,use_websockets){this.url=url,this.use_websockets=null!=use_websockets?use_websockets:!0,this.connection_stale=__bind(this.connection_stale,this),this.pong=__bind(this.pong,this),this.supports_websockets=__bind(this.supports_websockets,this),this.dispatch_channel=__bind(this.dispatch_channel,this),this.unsubscribe=__bind(this.unsubscribe,this),this.subscribe_private=__bind(this.subscribe_private,this),this.subscribe=__bind(this.subscribe,this),this.dispatch=__bind(this.dispatch,this),this.trigger_event=__bind(this.trigger_event,this),this.trigger=__bind(this.trigger,this),this.unbind=__bind(this.unbind,this),this.bind=__bind(this.bind,this),this.connection_established=__bind(this.connection_established,this),this.new_message=__bind(this.new_message,this),this.reconnect=__bind(this.reconnect,this),this.callbacks={},this.channels={},this.queue={},this.connect()}return WebSocketRails.prototype.connect=function(){return this.state=\"connecting\",this._conn=this.supports_websockets()&&this.use_websockets?new WebSocketRails.WebSocketConnection(this.url,this):new WebSocketRails.HttpConnection(this.url,this),this._conn.new_message=this.new_message},WebSocketRails.prototype.disconnect=function(){return this._conn&&(this._conn.close(),delete this._conn._conn,delete this._conn),this.state=\"disconnected\"},WebSocketRails.prototype.reconnect=function(){var event,id,old_connection_id,_ref,_ref1;old_connection_id=null!=(_ref=this._conn)?_ref.connection_id:void 0,this.disconnect(),this.connect(),_ref1=this.queue;for(id in _ref1)event=_ref1[id],event.connection_id!==old_connection_id||event.is_result()||this.trigger_event(event);return this.reconnect_channels()},WebSocketRails.prototype.new_message=function(data){var event,socket_message,_i,_len,_ref,_results;for(_results=[],_i=0,_len=data.length;_len>_i;_i++)socket_message=data[_i],event=new WebSocketRails.Event(socket_message),event.is_result()?(null!=(_ref=this.queue[event.id])&&_ref.run_callbacks(event.success,event.data),delete this.queue[event.id]):event.is_channel()?this.dispatch_channel(event):event.is_ping()?this.pong():this.dispatch(event),_results.push(\"connecting\"===this.state&&\"client_connected\"===event.name?this.connection_established(event.data):void 0);return _results},WebSocketRails.prototype.connection_established=function(data){return this.state=\"connected\",this._conn.setConnectionId(data.connection_id),this._conn.flush_queue(),null!=this.on_open?this.on_open(data):void 0},WebSocketRails.prototype.bind=function(event_name,callback){var _base;return null==(_base=this.callbacks)[event_name]&&(_base[event_name]=[]),this.callbacks[event_name].push(callback)},WebSocketRails.prototype.unbind=function(event_name){return delete this.callbacks[event_name]},WebSocketRails.prototype.trigger=function(event_name,data,success_callback,failure_callback){var event,_ref;return event=new WebSocketRails.Event([event_name,data,null!=(_ref=this._conn)?_ref.connection_id:void 0],success_callback,failure_callback),this.trigger_event(event)},WebSocketRails.prototype.trigger_event=function(event){var _base,_name;return null==(_base=this.queue)[_name=event.id]&&(_base[_name]=event),this._conn&&this._conn.trigger(event),event},WebSocketRails.prototype.dispatch=function(event){var callback,_i,_len,_ref,_results;if(null!=this.callbacks[event.name]){for(_ref=this.callbacks[event.name],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)callback=_ref[_i],_results.push(callback(event.data));return _results}},WebSocketRails.prototype.subscribe=function(channel_name,success_callback,failure_callback){var channel;return null==this.channels[channel_name]?(channel=new WebSocketRails.Channel(channel_name,this,!1,success_callback,failure_callback),this.channels[channel_name]=channel,channel):this.channels[channel_name]},WebSocketRails.prototype.subscribe_private=function(channel_name,success_callback,failure_callback){var channel;return null==this.channels[channel_name]?(channel=new WebSocketRails.Channel(channel_name,this,!0,success_callback,failure_callback),this.channels[channel_name]=channel,channel):this.channels[channel_name]},WebSocketRails.prototype.unsubscribe=function(channel_name){return null!=this.channels[channel_name]?(this.channels[channel_name].destroy(),delete this.channels[channel_name]):void 0},WebSocketRails.prototype.dispatch_channel=function(event){return null!=this.channels[event.channel]?this.channels[event.channel].dispatch(event.name,event.data):void 0},WebSocketRails.prototype.supports_websockets=function(){return\"function\"==typeof WebSocket||\"object\"==typeof WebSocket},WebSocketRails.prototype.pong=function(){var pong,_ref;return pong=new WebSocketRails.Event([\"websocket_rails.pong\",{},null!=(_ref=this._conn)?_ref.connection_id:void 0]),this._conn.trigger(pong)},WebSocketRails.prototype.connection_stale=function(){return\"connected\"!==this.state},WebSocketRails.prototype.reconnect_channels=function(){var callbacks,channel,name,_ref,_results;_ref=this.channels,_results=[];for(name in _ref)channel=_ref[name],callbacks=channel._callbacks,channel.destroy(),delete this.channels[name],channel=channel.is_private?this.subscribe_private(name):this.subscribe(name),channel._callbacks=callbacks,_results.push(channel);return _results},WebSocketRails}()}).call(this),function(){WebSocketRails.Event=function(){function Event(data,success_callback,failure_callback){var attr;this.success_callback=success_callback,this.failure_callback=failure_callback,this.name=data[0],attr=data[1],null!=attr&&(this.id=null!=attr.id?attr.id:65536*(1+Math.random())|0,this.channel=null!=attr.channel?attr.channel:void 0,this.data=null!=attr.data?attr.data:attr,this.token=null!=attr.token?attr.token:void 0,this.connection_id=data[2],null!=attr.success&&(this.result=!0,this.success=attr.success))}return Event.prototype.is_channel=function(){return null!=this.channel},Event.prototype.is_result=function(){return\"undefined\"!=typeof this.result},Event.prototype.is_ping=function(){return\"websocket_rails.ping\"===this.name},Event.prototype.serialize=function(){return JSON.stringify([this.name,this.attributes()])},Event.prototype.attributes=function(){return{id:this.id,channel:this.channel,data:this.data,token:this.token}},Event.prototype.run_callbacks=function(success,result){return this.success=success,this.result=result,this.success===!0?\"function\"==typeof this.success_callback?this.success_callback(this.result):void 0:\"function\"==typeof this.failure_callback?this.failure_callback(this.result):void 0},Event}()}.call(this),function(){WebSocketRails.AbstractConnection=function(){function AbstractConnection(url,dispatcher){this.dispatcher=dispatcher,this.message_queue=[]}return AbstractConnection.prototype.close=function(){},AbstractConnection.prototype.trigger=function(event){return\"connected\"!==this.dispatcher.state?this.message_queue.push(event):this.send_event(event)},AbstractConnection.prototype.send_event=function(event){return null!=this.connection_id?event.connection_id=this.connection_id:void 0},AbstractConnection.prototype.on_close=function(event){var close_event;return this.dispatcher&&this.dispatcher._conn===this?(close_event=new WebSocketRails.Event([\"connection_closed\",event]),this.dispatcher.state=\"disconnected\",this.dispatcher.dispatch(close_event)):void 0},AbstractConnection.prototype.on_error=function(event){var error_event;return this.dispatcher&&this.dispatcher._conn===this?(error_event=new WebSocketRails.Event([\"connection_error\",event]),this.dispatcher.state=\"disconnected\",this.dispatcher.dispatch(error_event)):void 0},AbstractConnection.prototype.on_message=function(event_data){return this.dispatcher&&this.dispatcher._conn===this?this.dispatcher.new_message(event_data):void 0},AbstractConnection.prototype.setConnectionId=function(connection_id){this.connection_id=connection_id},AbstractConnection.prototype.flush_queue=function(){var event,_i,_len,_ref;for(_ref=this.message_queue,_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],this.trigger(event);return this.message_queue=[]},AbstractConnection}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};WebSocketRails.WebSocketConnection=function(_super){function WebSocketConnection(url,dispatcher){this.url=url,this.dispatcher=dispatcher,WebSocketConnection.__super__.constructor.apply(this,arguments),this.url.match(/^wss?:\\/\\//)?console.log(\"WARNING: Using connection urls with protocol specified is depricated\"):this.url=\"https:\"===window.location.protocol?\"wss://\"+this.url:\"ws://\"+this.url,this._conn=new WebSocket(this.url),this._conn.onmessage=function(_this){return function(event){var event_data;return event_data=JSON.parse(event.data),_this.on_message(event_data)}}(this),this._conn.onclose=function(_this){return function(event){return _this.on_close(event)}}(this),this._conn.onerror=function(_this){return function(event){return _this.on_error(event)}}(this)}return __extends(WebSocketConnection,_super),WebSocketConnection.prototype.connection_type=\"websocket\",WebSocketConnection.prototype.close=function(){return this._conn.close()},WebSocketConnection.prototype.send_event=function(event){return WebSocketConnection.__super__.send_event.apply(this,arguments),this._conn.send(event.serialize())},WebSocketConnection}(WebSocketRails.AbstractConnection)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};WebSocketRails.Channel=function(){function Channel(name,_dispatcher,is_private,on_success,on_failure){var event,event_name,_ref;this.name=name,this._dispatcher=_dispatcher,this.is_private=null!=is_private?is_private:!1,this.on_success=on_success,this.on_failure=on_failure,this._failure_launcher=__bind(this._failure_launcher,this),this._success_launcher=__bind(this._success_launcher,this),this._callbacks={},this._token=void 0,this._queue=[],event_name=this.is_private?\"websocket_rails.subscribe_private\":\"websocket_rails.subscribe\",this.connection_id=null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0,event=new WebSocketRails.Event([event_name,{data:{channel:this.name}},this.connection_id],this._success_launcher,this._failure_launcher),this._dispatcher.trigger_event(event)}return Channel.prototype.destroy=function(){var event,event_name,_ref;return this.connection_id===(null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0)&&(event_name=\"websocket_rails.unsubscribe\",event=new WebSocketRails.Event([event_name,{data:{channel:this.name}},this.connection_id]),this._dispatcher.trigger_event(event)),this._callbacks={}},Channel.prototype.bind=function(event_name,callback){var _base;return null==(_base=this._callbacks)[event_name]&&(_base[event_name]=[]),this._callbacks[event_name].push(callback)},Channel.prototype.unbind=function(event_name){return delete this._callbacks[event_name]},Channel.prototype.trigger=function(event_name,message){var event;return event=new WebSocketRails.Event([event_name,{channel:this.name,data:message,token:this._token},this.connection_id]),this._token?this._dispatcher.trigger_event(event):this._queue.push(event)},Channel.prototype.dispatch=function(event_name,message){var callback,_i,_len,_ref,_ref1,_results;if(\"websocket_rails.channel_token\"===event_name)return this.connection_id=null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0,this._token=message.token,this.flush_queue();if(null!=this._callbacks[event_name]){for(_ref1=this._callbacks[event_name],_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)callback=_ref1[_i],_results.push(callback(message));return _results}},Channel.prototype._success_launcher=function(data){return null!=this.on_success?this.on_success(data):void 0},Channel.prototype._failure_launcher=function(data){return null!=this.on_failure?this.on_failure(data):void 0},Channel.prototype.flush_queue=function(){var event,_i,_len,_ref;for(_ref=this._queue,_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],this._dispatcher.trigger_event(event);return this._queue=[]},Channel}()}.call(this);","/*!\n * JavaScript Cookie v2.2.0\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader = false;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\tvar stringifiedAttributes = '';\n\n\t\t\t\tfor (var attributeName in attributes) {\n\t\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName];\n\t\t\t\t}\n\t\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (!this.json && cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api.call(api, key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","function detectBrowser(userAgentString) {\n  var browsers = [\n    [ 'edge', /Edge\\/([0-9\\._]+)/ ],\n    [ 'chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/ ],\n    [ 'firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/ ],\n    [ 'opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/ ],\n    [ 'opera', /OPR\\/([0-9\\.]+)(:?\\s|$)$/ ],\n    [ 'ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+)\\).*Gecko$/ ],\n    [ 'ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/ ],\n    [ 'ie', /MSIE\\s(7\\.0)/ ],\n    [ 'bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/ ],\n    [ 'android', /Android\\s([0-9\\.]+)/ ],\n    [ 'ios', /iPad.*Version\\/([0-9\\._]+)/ ],\n    [ 'ios',  /iPhone.*Version\\/([0-9\\._]+)/ ],\n    [ 'safari', /Version\\/([0-9\\._]+).*Safari/ ]\n  ];\n\n  var i = 0, mapped =[];\n  for (i = 0; i < browsers.length; i++) {\n    browsers[i] = createMatch(browsers[i]);\n    if (isMatch(browsers[i])) {\n      mapped.push(browsers[i]);\n    }\n  }\n\n  var match = mapped[0];\n  var parts = match && match[3].split(/[._]/).slice(0,3);\n\n  while (parts && parts.length < 3) {\n    parts.push('0');\n  }\n\n  function createMatch(pair) {\n    return pair.concat(pair[1].exec(userAgentString));\n  }\n\n  function isMatch(pair) {\n    return !!pair[2];\n  }\n\n  // return the name and version\n  return {\n    name: match && match[0],\n    version: parts && parts.join('.'),\n  };\n};\n","//Kaanjo.socket = new WebSocketRails('localhost:3000/websocket'),\n;(Kaanjo.socket = new WebSocketRails('dashboard.kaanjo.co/websocket')),\n  (Kaanjo.init = function() {\n    Kaanjo.container = document.getElementById('kaanjo')\n\n    if (!Kaanjo.valid(Kaanjo.container)) return false\n\n    for (const attribute in Kaanjo.attributes) {\n      Kaanjo.attributes[attribute] = Kaanjo.container.getAttribute(\n        `data-${attribute}`\n      )\n    }\n\n    Kaanjo.request(\n      'init',\n      {\n        campaign_id: Kaanjo.cid,\n        webmaster_sid: Kaanjo.attributes.key,\n        product_name: Kaanjo.attributes.name,\n        product_sid: Kaanjo.attributes.id,\n        customer_sid: Kaanjo.cookies.get('kaanjo_cid'),\n        url: window.location.href,\n        device: detectBrowser(navigator.userAgent).name\n      },\n      success => {\n        Kaanjo.log('Kaanjo initialized')\n        if (success.msg) Kaanjo.log(success.msg)\n        if (success.c_sid) {\n          Kaanjo.cookies.set('kaanjo_cid', success.c_sid)\n        }\n        Kaanjo.render_buttons()\n      },\n      fail => {\n        Kaanjo.log(fail.msg)\n      }\n    )\n  })\n\nKaanjo.react = function(reaction_id) {\n  Kaanjo.request(\n    'react',\n    {\n      id: reaction_id\n    },\n    success => {\n      Kaanjo.log(success.msg)\n      Kaanjo.select(reaction_id)\n    },\n    fail => {\n      Kaanjo.log(fail.msg)\n    }\n  )\n}\n\nKaanjo.select = function(id) {\n  let buttons = document.getElementsByClassName('kaanjo-reaction')\n  let arr = []\n  arr.forEach.call(buttons, function(button) {\n    button.classList.add('kaanjo-unselected')\n  })\n  let e = document.getElementById(`kaanjo-reaction${id}`)\n  e.classList.remove('kaanjo-unselected')\n  Kaanjo.render_status()\n}\n\nKaanjo.render_buttons = function() {\n  Kaanjo.request('get_buttons', {}, html => {\n    Kaanjo.container.innerHTML = html\n  })\n}\n\nKaanjo.render_status = function() {\n  Kaanjo.request('get_status', {}, html => {\n    document.getElementById('kaanjo-status').innerHTML = html\n  })\n}\n\nKaanjo.cookies = Cookies.noConflict()\n\nKaanjo.request = function(action, data, success, fail) {\n  Kaanjo.socket.trigger(action, data, success, fail)\n}\n\nKaanjo.valid = function(hook) {\n  let is_valid = true\n\n  if (hook == null) {\n    is_valid = false\n  } else {\n    for (const attribute in Kaanjo.attributes) {\n      if (!hook.hasAttribute(`data-${attribute}`) && attribute !== 'id') {\n        console.error(\n          `Kaanjo: You are missing the '${attribute}' attribute in your HTML.`\n        )\n        is_valid = false\n      }\n    }\n  }\n\n  return is_valid\n}\n\nKaanjo.attributes = {\n  key: null,\n  name: null,\n  id: null\n}\n\nKaanjo.log = function(msg) {\n  if (msg) console.log(msg)\n}\n\nKaanjo.socket.on_open = function(data) {\n  setTimeout(() => {\n    Kaanjo.init()\n  }, 500)\n}\n"]}